<mat-expansion-panel>
  <mat-expansion-panel-header>
    <mat-panel-title>{{ stepFormGroup.controls.type.value || 'Audit Step Required!' }}</mat-panel-title>
  </mat-expansion-panel-header>
  <button  class='toggle_menu' mat-icon-button (click)='$event.preventDefault()' [matMenuTriggerFor]="menu" aria-label="Toggle menu">
    <mat-icon>more_vert</mat-icon>
  </button>
  <div class='row'>
    <div class='col'>
      <mat-form-field>
        <mat-label>Step Type</mat-label>
        <mat-select [formControl]='stepFormGroup.controls.type' (selectionChange)='valueChange.emit($event)'>
          <mat-optgroup *rxFor='let GROUP of AUDIT_STEP_OPTION_GROUPS' [label]='GROUP.name'>
            <mat-option *rxFor='let OPTION of GROUP.options' [value]='OPTION.value'>
              {{OPTION.value}}
            </mat-option>
          </mat-optgroup>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <div class='row' *rxFor='let prop of getTopLevelProps()'>
    <div class='col'>
      <mat-form-field>
        <mat-label>{{prop.name}}</mat-label>
        <input matInput [formControl]='prop.control'>
      </mat-form-field>
    </div>
  </div>

  <mat-divider />

  <div class='col'>
    <button style='margin: 8px 8px 0 0;' *rxFor='let prop of unusedProperties()' mat-raised-button>{{prop}}</button>
  </div>
</mat-expansion-panel>

<mat-menu #menu="matMenu" xPosition="before">
    <button mat-menu-item (click)='action.emit("add-before")'>Add Step Before</button>
    <button mat-menu-item (click)='action.emit("add-after")'>Add Step After</button>
    <button mat-menu-item (click)='action.emit("remove")'>Remove Step</button>
</mat-menu>
