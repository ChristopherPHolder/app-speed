<mat-expansion-panel>
  <mat-expansion-panel-header>
    <mat-panel-title>{{ controller.type.value || 'Audit Step Required!' }}</mat-panel-title>
    <!-- TODO implement Logo for actionType -->
  </mat-expansion-panel-header>
  <button  class='toggle_menu' mat-icon-button (click)='$event.preventDefault()' [matMenuTriggerFor]="menu" aria-label="Toggle menu">
    <mat-icon>more_vert</mat-icon>
  </button>
  <div class='row'>
    <div class='col'>
      <mat-form-field>
        <mat-label>Step Type</mat-label>
        <mat-select [formControl]='controller.type' (selectionChange)='controller.reset();valueChange.emit()'>
          <mat-optgroup *rxFor='let GROUP of AUDIT_STEP_OPTION_GROUPS' [label]='GROUP.name'>
            <mat-option *rxFor='let OPTION of GROUP.options' [value]='OPTION.value'>{{OPTION.value}}</mat-option>
          </mat-optgroup>
        </mat-select>
      </mat-form-field>
    </div>
  </div>
  <div class='row' *ngFor='let prop of controller.stepProps'>
    <div *ngIf='prop.type === "string"' class='col'>
      <mat-form-field>
        <mat-label>{{prop.name}}</mat-label>
        <input matInput [formControl]='prop.control'>
      </mat-form-field>
    </div>
    <div *ngIf='prop.type === "object"' class='col'>
      {{ prop.name }}
      <ng-container *ngFor='let subProp of prop.subProps'>
        <div *ngIf='subProp.type === "string"' class='col'>
          <mat-form-field>
            <mat-label>{{subProp.name}}</mat-label>
            <input matInput [formControl]='subProp.control'>
          </mat-form-field>
        </div>
      </ng-container>
    </div>
  </div>

  <ng-container *rxIf='controller.additionalProps; let additionalProps'>
    <mat-divider *ngIf='additionalProps.length' />
    <div class='col'>
      <button
        mat-raised-button
        *rxFor='let prop of additionalProps'
        (click)='controller.addProp(prop);valueChange.emit()'
        style='margin: 8px 8px 0 0;'
      >{{prop.value}}</button>
    </div>
  </ng-container>
</mat-expansion-panel>

<mat-menu #menu="matMenu" xPosition="before">
    <button mat-menu-item (click)='action.emit("add-before")'>Add Step Before</button>
    <button mat-menu-item (click)='action.emit("add-after")'>Add Step After</button>
    <button mat-menu-item (click)='action.emit("remove")'>Remove Step</button>
</mat-menu>
